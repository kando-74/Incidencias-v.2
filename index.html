<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Incidencias</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="app-header" role="banner">
      <h1>Gestión de incidencias</h1>
      <nav aria-label="Acciones de sesión">
        <button id="btn-logout" type="button" class="btn secondary" hidden>
          Cerrar sesión
        </button>
      </nav>
    </header>

    <main id="main-content" class="app-main" tabindex="-1">
      <section id="login-view" class="view" aria-labelledby="login-title">
        <div class="card">
          <h2 id="login-title">Iniciar sesión</h2>
          <form id="login-form" autocomplete="on">
            <label for="login-email">Correo electrónico</label>
            <input
              id="login-email"
              name="email"
              type="email"
              autocomplete="email"
              required
            />

            <label for="login-password">Contraseña</label>
            <input
              id="login-password"
              name="password"
              type="password"
              autocomplete="current-password"
              required
            />

            <button type="submit" class="btn primary">Entrar</button>
            <p id="login-error" class="form-error" role="alert" aria-live="assertive"></p>
          </form>
        </div>
      </section>

      <section id="app-view" class="view hidden" aria-labelledby="app-title" hidden>
        <div class="toolbar" role="toolbar" aria-label="Acciones principales">
          <h2 id="app-title">Panel de incidencias</h2>
          <div class="toolbar-actions">
            <button
              class="btn primary"
              type="button"
              data-modal-target="modal-incidencia"
              data-modal-mode="create"
            >
              Nueva incidencia
            </button>
            <button class="btn" type="button" data-modal-target="modal-filtros">
              Filtros avanzados
            </button>
            <button class="btn" type="button" data-modal-target="modal-edificios">
              Gestionar edificios
            </button>
            <button class="btn" type="button" data-modal-target="modal-reparadores">
              Gestionar reparadores
            </button>
            <button class="btn" type="button" data-modal-target="modal-polizas">
              Gestionar pólizas
            </button>
            <button class="btn" type="button" id="btn-toggle-vista" data-view="lista">
              Ver Kanban
            </button>
            <button class="btn" type="button" id="btn-exportar">
              Exportar CSV
            </button>
            <button class="btn" type="button" id="btn-imprimir">
              Imprimir
            </button>
          </div>
        </div>

        <section id="panel-diario" class="panel-diario" aria-label="Resumen diario">
          <article class="panel-diario-card" role="status">
            <header>
              <h3>Resumen de hoy</h3>
              <p class="hint">Actividad rápida para priorizar</p>
            </header>
            <dl class="panel-diario-metricas">
              <div class="panel-diario-item">
                <dt>Abiertas</dt>
                <dd>
                  <span id="metric-abiertas" class="metric-value">0</span>
                  <span
                    id="metric-abiertas-delta"
                    class="metric-delta"
                    aria-live="polite"
                  ></span>
                </dd>
              </div>
              <div class="panel-diario-item">
                <dt>Por vencer (&lt;48h)</dt>
                <dd>
                  <span id="metric-proximas" class="metric-value">0</span>
                  <span
                    id="metric-proximas-delta"
                    class="metric-delta"
                    aria-live="polite"
                  ></span>
                </dd>
              </div>
              <div class="panel-diario-item">
                <dt>Sin asignar</dt>
                <dd>
                  <span id="metric-sin-asignar" class="metric-value">0</span>
                  <span
                    id="metric-sin-asignar-delta"
                    class="metric-delta"
                    aria-live="polite"
                  ></span>
                </dd>
              </div>
              <div class="panel-diario-item">
                <dt>Nuevas hoy</dt>
                <dd>
                  <span id="metric-nuevas" class="metric-value">0</span>
                  <span
                    id="metric-nuevas-delta"
                    class="metric-delta"
                    aria-live="polite"
                  ></span>
                </dd>
              </div>
            </dl>
          </article>
        </section>

        <section class="resumen" aria-live="polite">
          <div class="resumen-item">
            <span class="resumen-label">Total:</span>
            <span id="resumen-total" class="resumen-value">0</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">Abiertas:</span>
            <span id="resumen-abiertas" class="resumen-value">0</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">En proceso:</span>
            <span id="resumen-proceso" class="resumen-value">0</span>
          </div>
          <div class="resumen-item">
            <span class="resumen-label">Cerradas:</span>
            <span id="resumen-cerradas" class="resumen-value">0</span>
          </div>
        </section>

        <section class="listado" aria-label="Listado de incidencias" data-view="lista">
          <div class="listado-filtros">
            <label class="sr-only" for="filtro-busqueda">Buscar incidencia</label>
            <input
              id="filtro-busqueda"
              type="search"
              placeholder="Buscar por título o referencia"
              aria-describedby="hint-busqueda"
            />
            <span id="hint-busqueda" class="hint">
              Pulsa Enter para aplicar búsqueda rápida.
            </span>
          </div>
          <div
            id="filtros-rapidos"
            class="filtros-rapidos"
            aria-live="polite"
          ></div>
          <div
            id="lista-incidencias"
            role="listbox"
            aria-label="Incidencias"
            class="lista-incidencias"
            aria-activedescendant=""
          ></div>
        </section>

        <section
          id="kanban-board"
          class="kanban hidden"
          aria-label="Kanban de incidencias"
          data-view="kanban"
          hidden
        >
          <div class="kanban-column" data-estado="abierta">
            <h3 id="kanban-abierta-titulo">Abiertas</h3>
            <div
              id="kanban-abierta"
              class="kanban-list"
              role="listbox"
              aria-labelledby="kanban-abierta-titulo"
              aria-activedescendant=""
            ></div>
          </div>
          <div class="kanban-column" data-estado="en_proceso">
            <h3 id="kanban-proceso-titulo">En proceso</h3>
            <div
              id="kanban-en-proceso"
              class="kanban-list"
              role="listbox"
              aria-labelledby="kanban-proceso-titulo"
              aria-activedescendant=""
            ></div>
          </div>
          <div class="kanban-column" data-estado="cerrada">
            <h3 id="kanban-cerrada-titulo">Cerradas</h3>
            <div
              id="kanban-cerrada"
              class="kanban-list"
              role="listbox"
              aria-labelledby="kanban-cerrada-titulo"
              aria-activedescendant=""
            ></div>
          </div>
        </section>

        <aside id="detalle-panel" class="detalle" aria-live="polite">
          <h3>Detalle de la incidencia</h3>
          <dl>
            <div>
              <dt>Título</dt>
              <dd id="detalle-titulo">Selecciona una incidencia</dd>
            </div>
            <div>
              <dt>Descripción</dt>
              <dd id="detalle-descripcion">—</dd>
            </div>
            <div>
              <dt>Estado</dt>
              <dd id="detalle-estado">—</dd>
            </div>
            <div>
              <dt>Prioridad</dt>
              <dd id="detalle-prioridad">—</dd>
            </div>
            <div>
              <dt>Edificio</dt>
              <dd id="detalle-edificio">—</dd>
            </div>
            <div>
              <dt>Reparador</dt>
              <dd id="detalle-reparador">—</dd>
            </div>
            <div>
              <dt>Fechas</dt>
              <dd id="detalle-fechas">—</dd>
            </div>
          <div>
            <dt>Siniestro</dt>
            <dd id="detalle-siniestro">—</dd>
          </div>
          <div>
            <dt>Póliza</dt>
            <dd id="detalle-poliza">—</dd>
          </div>
          <div>
            <dt>Archivos</dt>
            <dd id="detalle-archivos">—</dd>
          </div>
        </dl>
          <div class="detalle-acciones">
            <button id="btn-abrir-archivos" class="btn" type="button" disabled>
              Ver archivos
            </button>
            <!-- INICIO: BOTON-ELIMINAR-INCIDENCIA -->
            <button id="btn-eliminar-incidencia" class="btn danger" type="button" disabled>
              Eliminar incidencia
            </button>
            <!-- FIN: BOTON-ELIMINAR-INCIDENCIA -->
          </div>
          <section
            class="detalle-checklist"
            aria-labelledby="detalle-checklist-titulo"
          >
            <h4 id="detalle-checklist-titulo">Checklist de resolución</h4>
            <div id="checklist-contenido" class="checklist"></div>
          </section>
        </aside>
      </section>
    </main>

    <div id="modal-root"></div>

    <!-- INICIO: MODAL-EDIFICIOS -->
    <dialog
      id="modal-edificios"
      class="modal"
      aria-modal="true"
      role="dialog"
      aria-labelledby="modal-edificios-titulo"
    >
      <div class="modal-content modal-content--wide">
        <header class="modal-header">
          <h2 id="modal-edificios-titulo">Gestión de edificios</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body modal-body--split">
          <section class="modal-panel">
            <h3 id="modal-edificios-form-titulo">Añadir edificio</h3>
            <form id="form-edificio" class="form-edificio">
              <input type="hidden" id="edificio-id" name="id" />
              <label for="edificio-nombre">Nombre *</label>
              <input id="edificio-nombre" name="nombre" type="text" required />

              <label for="edificio-direccion">Dirección</label>
              <input id="edificio-direccion" name="direccion" type="text" />

              <label for="edificio-contacto">Persona de contacto</label>
              <input id="edificio-contacto" name="contacto" type="text" />

              <label for="edificio-poliza">Póliza asociada</label>
              <select id="edificio-poliza" name="defaultPolizaId"></select>

              <label for="edificio-notas">Notas</label>
              <textarea id="edificio-notas" name="notas" rows="3"></textarea>

              <p
                id="edificio-error"
                class="form-error"
                role="alert"
                aria-live="assertive"
              ></p>

              <div class="modal-footer modal-footer--inline">
                <button type="submit" class="btn primary" id="btn-guardar-edificio">
                  Guardar edificio
                </button>
                <button type="button" class="btn" id="btn-cancelar-edificio">
                  Cancelar
                </button>
              </div>
            </form>
          </section>
          <section class="modal-panel">
            <h3 id="modal-edificios-lista-titulo">Edificios registrados</h3>
            <ul id="lista-edificios" class="lista-edificios"></ul>
          </section>
        </div>
      </div>
    </dialog>
    <!-- FIN: MODAL-EDIFICIOS -->

    <!-- INICIO: MODAL-REPARADORES -->
    <dialog
      id="modal-reparadores"
      class="modal"
      aria-modal="true"
      role="dialog"
      aria-labelledby="modal-reparadores-titulo"
    >
      <div class="modal-content modal-content--wide">
        <header class="modal-header">
          <h2 id="modal-reparadores-titulo">Gestión de reparadores</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body modal-body--split">
          <section class="modal-panel">
            <h3 id="modal-reparadores-form-titulo">Añadir reparador</h3>
            <form id="form-reparador" class="form-reparador">
              <input type="hidden" id="reparador-id" name="id" />
              <label for="reparador-nombre">Nombre *</label>
              <input id="reparador-nombre" name="nombre" type="text" required />

              <label for="reparador-especialidad">Especialidad</label>
              <input id="reparador-especialidad" name="especialidad" type="text" />

              <label for="reparador-telefono">Teléfono</label>
              <input id="reparador-telefono" name="telefono" type="tel" />

              <label for="reparador-email">Correo electrónico</label>
              <input id="reparador-email" name="email" type="email" />

              <label for="reparador-notas">Notas</label>
              <textarea id="reparador-notas" name="notas" rows="3"></textarea>

              <p
                id="reparador-error"
                class="form-error"
                role="alert"
                aria-live="assertive"
              ></p>

              <div class="modal-footer modal-footer--inline">
                <button type="submit" class="btn primary" id="btn-guardar-reparador">
                  Guardar reparador
                </button>
                <button type="button" class="btn" id="btn-cancelar-reparador">
                  Cancelar
                </button>
              </div>
            </form>
          </section>
          <section class="modal-panel">
            <h3 id="modal-reparadores-lista-titulo">Reparadores registrados</h3>
            <ul id="lista-reparadores" class="lista-reparadores"></ul>
          </section>
        </div>
      </div>
    </dialog>
    <!-- FIN: MODAL-REPARADORES -->

    <!-- INICIO: MODAL-POLIZAS -->
    <dialog
      id="modal-polizas"
      class="modal"
      aria-modal="true"
      role="dialog"
      aria-labelledby="modal-polizas-titulo"
    >
      <div class="modal-content modal-content--wide">
        <header class="modal-header">
          <h2 id="modal-polizas-titulo">Gestión de pólizas</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body modal-body--split">
          <section class="modal-panel">
            <h3 id="modal-polizas-form-titulo">Añadir póliza</h3>
            <form id="form-poliza" class="form-poliza">
              <input type="hidden" id="poliza-id" name="id" />

              <label for="poliza-nombre">Nombre *</label>
              <input id="poliza-nombre" name="nombre" type="text" required />

              <label for="poliza-numero">Número de póliza</label>
              <input id="poliza-numero" name="numero" type="text" />

              <label for="poliza-compania">Compañía</label>
              <input id="poliza-compania" name="compania" type="text" />

              <label for="poliza-telefono">Teléfono de contacto</label>
              <input id="poliza-telefono" name="telefono" type="tel" />

              <label for="poliza-email">Correo de contacto</label>
              <input id="poliza-email" name="email" type="email" />

              <label for="poliza-notas">Notas</label>
              <textarea id="poliza-notas" name="notas" rows="3"></textarea>

              <p
                id="poliza-error"
                class="form-error"
                role="alert"
                aria-live="assertive"
              ></p>

              <div class="modal-footer modal-footer--inline">
                <button type="submit" class="btn primary" id="btn-guardar-poliza">
                  Guardar póliza
                </button>
                <button type="button" class="btn" id="btn-cancelar-poliza">
                  Cancelar
                </button>
              </div>
            </form>
          </section>
          <section class="modal-panel">
            <h3 id="modal-polizas-lista-titulo">Pólizas registradas</h3>
            <ul id="lista-polizas" class="lista-polizas"></ul>
          </section>
        </div>
      </div>
    </dialog>
    <!-- FIN: MODAL-POLIZAS -->

    <!-- INICIO: MODAL-INCIDENCIA -->
    <dialog
      id="modal-incidencia"
      class="modal"
      aria-modal="true"
      role="dialog"
      aria-labelledby="modal-incidencia-titulo"
      data-mode="create"
    >
      <div class="modal-content modal-content--with-notes">
        <form method="dialog" id="form-incidencia" class="modal-form">
          <header class="modal-header">
            <h2 id="modal-incidencia-titulo">Nueva incidencia</h2>
            <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
          </header>
          <div class="modal-body modal-body--form-grid">
            <input type="hidden" id="incidencia-id" name="id" />
            <div class="form-field" data-span="full">
              <label for="incidencia-titulo">Título *</label>
              <input id="incidencia-titulo" name="titulo" type="text" required />
            </div>

            <div class="form-field" data-span="full">
              <label for="incidencia-descripcion">Descripción</label>
              <textarea id="incidencia-descripcion" name="descripcion" rows="4"></textarea>
            </div>

            <div class="form-field">
              <label for="incidencia-estado">Estado</label>
              <select id="incidencia-estado" name="estado">
                <option value="abierta">Abierta</option>
                <option value="en_proceso">En proceso</option>
                <option value="cerrada">Cerrada</option>
              </select>
            </div>

            <div class="form-field">
              <label for="incidencia-prioridad">Prioridad</label>
              <select id="incidencia-prioridad" name="prioridad">
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
                <option value="critica">Crítica</option>
              </select>
            </div>

            <div class="form-field">
              <label for="incidencia-edificio">Edificio</label>
              <select id="incidencia-edificio" name="edificioId"></select>
            </div>

            <div class="form-field">
              <label for="incidencia-reparador">Reparador</label>
              <select id="incidencia-reparador" name="reparadorId"></select>
            </div>

            <div class="form-field" data-span="full">
              <label for="incidencia-etiquetas">Etiquetas (separadas por comas)</label>
              <input id="incidencia-etiquetas" name="etiquetas" type="text" />
            </div>

            <fieldset class="form-field form-field--fieldset" data-span="full">
              <legend>Seguro</legend>
              <label class="checkbox">
                <input id="incidencia-siniestro" name="esSiniestro" type="checkbox" />
                Es siniestro
              </label>
              <div class="form-field-group">
                <div class="form-field">
                  <label for="incidencia-poliza">Póliza</label>
                  <select id="incidencia-poliza" name="polizaId"></select>
                </div>
                <div class="form-field">
                  <label for="incidencia-referencia">Referencia siniestro</label>
                  <input
                    id="incidencia-referencia"
                    name="referenciaSiniestro"
                    type="text"
                  />
                </div>
              </div>
            </fieldset>

            <div class="form-field">
              <label for="incidencia-fecha-limite">Fecha límite</label>
              <input id="incidencia-fecha-limite" name="fechaLimite" type="date" />
            </div>

            <div class="form-field" data-span="full">
              <label for="incidencia-archivo">Archivos</label>
              <input id="incidencia-archivo" name="archivos" type="file" multiple />
            </div>
          </div>
          <footer class="modal-footer">
            <span id="incidencia-error" class="form-error" role="alert" aria-live="assertive"></span>
            <button type="submit" class="btn primary">Guardar</button>
            <button type="button" class="btn" data-modal-close>Cancelar</button>
          </footer>
        </form>
        <section
          class="modal-comunicaciones detalle-comunicaciones"
          aria-labelledby="modal-comunicaciones-titulo"
        >
          <div class="detalle-comunicaciones-header">
            <h3 id="modal-comunicaciones-titulo">Historial de comunicación</h3>
            <p class="hint">
              Registra llamadas, correos o notas vinculadas a la incidencia.
            </p>
          </div>
          <ul id="comunicaciones-lista" class="comunicaciones-lista"></ul>
          <form id="form-comunicacion" class="form-comunicacion">
            <div class="form-row">
              <label for="comunicacion-tipo">Tipo de registro</label>
              <select id="comunicacion-tipo" name="tipo">
                <option value="llamada">Llamada</option>
                <option value="correo">Correo</option>
                <option value="nota">Nota interna</option>
              </select>
            </div>
            <div class="form-row">
              <label for="comunicacion-mensaje">Detalle</label>
              <textarea
                id="comunicacion-mensaje"
                name="mensaje"
                rows="3"
                required
              ></textarea>
            </div>
            <p
              id="comunicacion-error"
              class="form-error"
              role="alert"
              aria-live="assertive"
            ></p>
            <button type="submit" class="btn primary">Añadir registro</button>
          </form>
        </section>
      </div>
    </dialog>
    <!-- FIN: MODAL-INCIDENCIA -->

    <!-- INICIO: MODAL-FILTROS -->
    <dialog id="modal-filtros" class="modal" aria-modal="true" role="dialog" aria-labelledby="modal-filtros-titulo">
      <form method="dialog" id="form-filtros" class="modal-content">
        <header class="modal-header">
          <h2 id="modal-filtros-titulo">Filtros avanzados</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body grid">
          <label for="filtro-edificio">Edificio</label>
          <select id="filtro-edificio" name="edificioId"></select>
          <!-- INICIO: FILTRO-REPARADOR -->
          <label for="filtro-reparador">Reparador</label>
          <select id="filtro-reparador" name="reparadorId"></select>
          <!-- FIN: FILTRO-REPARADOR -->

          <label for="filtro-prioridad">Prioridad</label>
          <select id="filtro-prioridad" name="prioridad">
            <option value="">Todas</option>
            <option value="baja">Baja</option>
            <option value="media">Media</option>
            <option value="alta">Alta</option>
            <option value="critica">Crítica</option>
          </select>

          <label for="filtro-estado">Estado</label>
          <select id="filtro-estado" name="estado">
            <option value="">Todos</option>
            <option value="abierta">Abierta</option>
            <option value="en_proceso">En proceso</option>
            <option value="cerrada">Cerrada</option>
          </select>

          <label for="filtro-desde">Desde</label>
          <input id="filtro-desde" name="desde" type="date" />

          <label for="filtro-hasta">Hasta</label>
          <input id="filtro-hasta" name="hasta" type="date" />

          <label for="filtro-etiquetas">Etiquetas</label>
          <input id="filtro-etiquetas" name="etiquetas" type="text" placeholder="limpieza, urgente" />

          <label class="checkbox">
            <input id="filtro-solo-siniestros" name="soloSiniestros" type="checkbox" />
            Solo siniestros
          </label>
          <div class="filtro-guardar" data-span="full">
            <label for="filtro-nombre-rapido">Guardar como filtro rápido</label>
            <input
              id="filtro-nombre-rapido"
              name="nombreFiltro"
              type="text"
              placeholder="Ej. Pendientes de limpieza"
            />
            <button type="button" id="btn-guardar-filtro" class="btn secondary">
              Guardar filtro
            </button>
            <p class="hint">
              Se guardarán los criterios actuales para reutilizarlos con un clic.
            </p>
          </div>
        </div>
        <footer class="modal-footer">
          <button type="reset" class="btn secondary" id="btn-limpiar-filtros">Limpiar</button>
          <button type="submit" class="btn primary">Aplicar</button>
        </footer>
      </form>
    </dialog>
    <!-- FIN: MODAL-FILTROS -->

    <!-- INICIO: MODAL-ARCHIVOS -->
    <dialog id="modal-archivos" class="modal" aria-modal="true" role="dialog" aria-labelledby="modal-archivos-titulo">
      <div class="modal-content">
        <header class="modal-header">
          <h2 id="modal-archivos-titulo">Archivos de la incidencia</h2>
          <button type="button" class="modal-close" data-modal-close aria-label="Cerrar">×</button>
        </header>
        <div class="modal-body" id="lista-archivos"></div>
      </div>
    </dialog>
    <!-- FIN: MODAL-ARCHIVOS -->

    <div id="modal-backdrop" class="modal-backdrop hidden" aria-hidden="true"></div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
